# ============================================================================
# Redis Queue Configuration
# ============================================================================
# Bu dosya, Laravel queue için güvenli Redis konfigürasyonu içerir.
# Queue job'larının restart sonrası kaybolmaması ve eviction policy
# nedeniyle silinmemesi için kritik ayarlar içerir.
# ============================================================================

# Port
port 6379

# Bind address
bind 0.0.0.0

# Protected mode (production'da şifre kullanıyorsanız)
protected-mode yes

# Password (production'da mutlaka ayarlayın!)
# requirepass your_secure_password_here

# ============================================================================
# PERSISTENCE (RDB + AOF)
# ============================================================================
# Queue job'larının restart sonrası kaybolmaması için persistence aktif olmalı

# RDB Snapshot (Hızlı yedekleme)
save 900 1      # 15 dakikada en az 1 key değişirse snapshot
save 300 10     # 5 dakikada en az 10 key değişirse snapshot
save 60 10000   # 1 dakikada en az 10000 key değişirse snapshot

# RDB dosya yolu
dir /data
dbfilename dump.rdb

# AOF (Append Only File) - Her komutu logla
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec  # Her saniye disk'e yaz (güvenlik + performans dengesi)
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# ============================================================================
# MEMORY MANAGEMENT
# ============================================================================
# ⚠️ ÖNEMLİ: Queue database'inde eviction policy "noeviction" olmalı!
# Aksi halde job'lar uçabilir (allkeys-lru, volatile-lru vb. kullanmayın!)

# Memory limit (production için uygun değeri ayarlayın)
maxmemory 2gb

# Eviction policy: noeviction (job'lar asla silinmez)
# ✅ Queue için önerilen: noeviction
# ❌ Kullanmayın: allkeys-lru, volatile-lru, allkeys-random (job'lar uçabilir!)
maxmemory-policy noeviction

# ============================================================================
# PERFORMANCE
# ============================================================================

# TCP keepalive
tcp-keepalive 300

# Timeout
timeout 0

# Max clients
maxclients 10000

# ============================================================================
# LOGGING
# ============================================================================

loglevel notice
logfile ""

# ============================================================================
# DATABASES
# ============================================================================

databases 16

# ============================================================================
# SECURITY
# ============================================================================

# Disable dangerous commands (production'da önerilir)
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command CONFIG "CONFIG_9d4f8a7b3c2e1f0a"

